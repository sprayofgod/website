<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spray of God</title>
  <style>
    :root{
      --reveal-delay: 5500ms;
      --fade-duration: 700ms;
      --text-bg: rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans",sans-serif;background:#000;color:#fff;overflow:hidden}
    .stage{position:fixed;inset:0;overflow:hidden}

    /* Loader */
    .loader{position:absolute;inset:0;display:grid;place-items:center;background:#000;z-index:60;transition:opacity var(--fade-duration) ease}
    .loader.hidden{opacity:0;pointer-events:none}
    .spinner{width:56px;height:56px;border-radius:50%;border:4px solid rgba(255,255,255,.25);border-top-color:#fff;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* YouTube bg */
    .ytbg{position:absolute;inset:0;overflow:hidden;background:#000}
    .ytbg iframe{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none}

    /* Logo */
    .logo{position:absolute;inset:0;display:grid;place-items:center;z-index:20;opacity:0;pointer-events:none;transition:opacity var(--fade-duration) ease,transform var(--fade-duration) ease}
    .logo.visible{opacity:1;pointer-events:auto}
    .logo img{width:50%;height:auto;object-fit:contain;filter:drop-shadow(0 6px 18px rgba(0,0,0,.55));cursor:pointer}
    .logo.fading{opacity:0;transform:scale(.96)}

    /* Reveal */
    .reveal{position:absolute;inset:0;background:#000 center/cover no-repeat;opacity:0;transition:opacity var(--fade-duration) ease;z-index:10;cursor:pointer}
    .reveal.visible{opacity:1}

    /* Bottom text */
    .cta{position:absolute;left:0;right:0;bottom:0;padding:20px clamp(16px,4vw,40px);z-index:30;display:flex;justify-content:center}
    .cta-inner{max-width:min(92ch,96vw);background:var(--text-bg);backdrop-filter:saturate(120%) blur(6px);padding:14px 18px;border-radius:12px;line-height:1.35;transform:translateY(12px);opacity:0;transition:transform var(--fade-duration) ease,opacity var(--fade-duration) ease}
    .cta.visible .cta-inner{opacity:1;transform:translateY(0)}

    /* Скрываем любые клики поверх кадра на случай UI YouTube */
    .freeze-shield{position:absolute;inset:0;z-index:15;pointer-events:none}
  </style>
</head>
<body>
  <div class="stage">
    <!-- Loader -->
    <div class="loader" id="loader">
      <div class="spinner"></div>
    </div>

    <!-- YouTube background -->
    <div class="ytbg" id="ytbg"></div>
    <div class="freeze-shield" id="shield"></div>

    <!-- Logo -->
    <div class="logo" id="logo">
      <img src="logo_trans.png" alt="Логотип" />
    </div>

    <!-- Reveal -->
    <div class="reveal" id="reveal" style="background-image:url('flow.png')"></div>

    <!-- Bottom text -->
    <div class="cta" id="cta"><div class="cta-inner">
      <strong>Дорогая Диана</strong><br/>
      Я очень сильно тебя люблю и всецело верю в тебя и все твои начинания! Я хочу, чтобы тебе сопутствовала удача, и я стараюсь и буду стараться тебе как-то облегчить нагрузку, потому что ощущаю свою причастность и большое желание тебе помогать чем могу и как умею!))
    </div></div>
  </div>

  <!-- YouTube API -->
  <script>
    const YT_ID = "zBBDpBXRd6I"; // видео

    (function(){
      const loader = document.getElementById('loader');
      const logo = document.getElementById('logo');
      const reveal = document.getElementById('reveal');
      const cta = document.getElementById('cta');
      const ytbg = document.getElementById('ytbg');
      const shield = document.getElementById('shield');

      let logoTimer=null, logoShown=false, interacted=false, hasStarted=false, player=null, watchTimer=null, frozen=false;

      const showLoader = ()=>{ if(!hasStarted) loader.classList.remove('hidden'); };
      const hideLoader = ()=> loader.classList.add('hidden');
      const scheduleLogo = ()=>{
        if(logoShown) return;
        clearTimeout(logoTimer);
        logoTimer=setTimeout(()=>{logo.classList.add('visible');logoShown=true;},5500);
      };

      function loadYTApi(){
        return new Promise(resolve=>{
          if(window.YT&&window.YT.Player) return resolve();
          const tag=document.createElement('script');
          tag.src="https://www.youtube.com/iframe_api";
          document.head.appendChild(tag);
          window.onYouTubeIframeAPIReady=()=>resolve();
        });
      }

      function createPlayer(){
        const holder=document.createElement('div');holder.id='yt-holder';ytbg.appendChild(holder);
        player=new YT.Player(holder,{
          videoId:YT_ID,
          playerVars:{
            autoplay:1,
            controls:0,
            disablekb:1,
            fs:0,
            modestbranding:1,
            rel:0,
            playsinline:1,
            mute:1,
            // Без loop – один прогон
            iv_load_policy:3,
            origin: location.origin
          },
          events:{onReady:onPlayerReady,onStateChange:onStateChange}
        });
      }

      function onPlayerReady(){
        sizeIframe();
        window.addEventListener('resize',sizeIframe);
        showLoader();
        try{ player.playVideo(); }catch(e){}
      }

      function onStateChange(e){
        const PS = YT.PlayerState;
        if(e.data===PS.PLAYING){
          markStarted();
          startFreezeWatch();
        } else if(e.data===PS.ENDED){
          // На всякий – если дошли до ENDED, сразу откатываемся на последний кадр
          freezeToLastFrame();
        }
      }

      function markStarted(){
        if(hasStarted) return;
        hasStarted=true;
        hideLoader();
        scheduleLogo();
      }

      function startFreezeWatch(){
        clearInterval(watchTimer);
        watchTimer=setInterval(()=>{
          if(!player || frozen) return;
          const dur = player.getDuration ? player.getDuration() : 0;
          const cur = player.getCurrentTime ? player.getCurrentTime() : 0;
          if(dur>0 && cur >= dur - 0.06){
            freezeToLastFrame();
          }
        }, 80);
      }

      function freezeToLastFrame(){
        if(frozen || !player) return;
        try{
          const dur = player.getDuration();
          // Перемещаемся за мгновение до конца и пауза – кадр остаётся на экране
          if(dur>0) player.seekTo(Math.max(dur - 0.06, 0), true);
          player.pauseVideo();
          frozen = true;
          clearInterval(watchTimer);
          // Щит поверх – чтобы не всплыл ютубовский UI при окончании
          shield.style.pointerEvents = 'auto';
        }catch(e){}
      }

      function sizeIframe(){
        const iframe=ytbg.querySelector('iframe');if(!iframe) return;
        const W=window.innerWidth,H=window.innerHeight,ratio=16/9;
        let w=W,h=W/ratio;if(h<H){h=H;w=H*ratio;}
        iframe.style.width=w+"px";iframe.style.height=h+"px";
      }

      // Reveal/back
      logo.addEventListener('click',()=>{
        if(interacted) return;interacted=true;
        logo.classList.add('fading');
        setTimeout(()=>{logo.style.display='none';},700);
        reveal.classList.add('visible');cta.classList.add('visible');
      });
      function reset(){
        reveal.classList.remove('visible');cta.classList.remove('visible');
        logo.style.display='';logo.classList.remove('fading');
        requestAnimationFrame(()=>logo.classList.add('visible'));interacted=false;
      }
      reveal.addEventListener('click',reset);
      document.addEventListener('keydown',e=>{if(e.key==='Escape') reset();});

      (async function init(){showLoader();await loadYTApi();createPlayer();})();
    })();
  </script>
</body>
</html>
